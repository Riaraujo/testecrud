<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Quest√µes</title>
    <link rel="icon" href="bastao.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            padding-bottom: 10px;
            border-bottom: 1px solid #3d5166;
            margin-bottom: 15px;
        }
        
        .sidebar-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .sidebar-subtitle {
            font-size: 14px;
            color: #a3b1c6;
        }
        
        .sidebar-menu {
            margin-bottom: 15px;
        }
        
        .sidebar-menu-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #a3b1c6;
            text-transform: uppercase;
        }
        
        .sidebar-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 10px;
            width: 100%;
            text-align: left;
        }
        
        .sidebar-button:hover {
            background-color: #2980b9;
        }
        
        .prova-list {
            list-style: none;
            margin-top: 10px;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .prova-item {
            padding: 8px 10px;
            margin-bottom: 5px;
            background-color: #34495e;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .prova-item:hover {
            background-color: #3d5166;
        }
        
        .prova-item.active {
            background-color: #3498db;
        }
        
        .prova-item-count {
            background-color: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 12px;
        }
        
        /* Pasta styles */
        .pasta-item {
            padding: 8px 10px;
            margin-bottom: 5px;
            background-color: #8e44ad;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            min-height: 40px;
        }
        
        .pasta-item:hover {
            background-color: #9b59b6;
        }
        
        .pasta-item.active {
            background-color: #e74c3c;
        }
        
        .pasta-icon {
            margin-right: 8px;
        }
        
        /* Context Menu */
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            min-width: 150px;
        }
        
        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            border-bottom: 1px solid #eee;
        }
        
        .context-menu-item:last-child {
            border-bottom: none;
        }
        
        .context-menu-item:hover {
            background-color: #f5f5f5;
        }
        
        .context-menu-item.danger {
            color: #dc3545;
        }
        
        .context-menu-item.danger:hover {
            background-color: #f8d7da;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }
        
        .editor-container {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .editor-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .editor-subtitle {
            font-size: 14px;
            color: #666;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        select.form-control {
            height: 36px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .form-col {
            flex: 1;
        }
        
        /* Linhas e Blocos */
        .linha {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .blocos-na-linha {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            min-height: 100px;
            align-items: stretch;
        }
        
        .bloco {
            border-radius: 6px;
            padding: 10px;
            cursor: move;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        
        .bloco-texto {
            background: #f8ffff;
            border: 1px solid #cce8f1;
            flex: 3;
            min-width: 300px;
        }
        
        .bloco-imagem {
            background: #fff8f8;
            border: 1px solid #f1cccc;
            flex: 1;
            min-width: 150px;
        }
        
        .bloco-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            position: relative;
        }
        
        .bloco-tipo {
            font-weight: bold;
            font-size: 14px;
            color: #495057;
        }
        
        .controles-bloco button {
            background: #6c757d;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .texto-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .texto-content textarea {
            flex-grow: 1;
            width: 100%;
            min-height: 120px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            resize: vertical;
        }
        
        .imagem-content input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .controles-texto {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }
        
        .tipo-texto-select, .alinhamento-select {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 13px;
        }
        
        .controles-linha {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn-add-bloco {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .btn-remover-linha {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        /* Alternativas */
        .alternativas-container {
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .alternativas-container h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .alternativa-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 8px;
        }
        
        .alternativa-letra {
            font-weight: bold;
            min-width: 25px;
            text-align: center;
        }
        
        .alternativa-input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .btn-remover-alternativa {
            background: #dc3545;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        /* Bot√µes de a√ß√£o */
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-add-linha {
            background: #6f42c1;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-salvar {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        
        .btn-voltar {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            width: 80%;
            max-width: 800px;
            border-radius: 8px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }
        
        .preview-area {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            max-height: 50vh;
            overflow-y: auto;
        }
        
        #codigo-gerado {
            color: #d4d4d4;
            font-family: Consolas, monospace;
            white-space: pre-wrap;
            margin: 0;
            font-size: 14px;
        }
        
        .btn-copiar {
            background: #17a2b8;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }
        
        /* Estilos para tipos de texto (NOVOS) */
        .enunciado {
            display: flex;
            align-items: center;
            font-weight: 500 !important;
        }
        
        .poema, .carta {
            white-space: pre-line;
            padding: 10px !important;
        }
        
        .esquerda {
            text-align: left;
        }
        
        .centralizado {
            text-align: center;
        }
        
        .direita {
            text-align: right;
        }
        
        .referencia {
            font-size: small;
            font-style: italic !important;
            color: #636e72 !important;
            margin-top: -20px !important;
            padding: 35px;
            margin-left: -30px;
        }
        
        .cabecalho {
            font-weight: bold !important;
            margin-bottom: 10px !important;
            color: #cc1d75;
        }
        
        /* Estilos para o modal de criar prova */
        .modal-form {
            margin-top: 15px;
        }
        
        .modal-form-group {
            margin-bottom: 15px;
        }
        
        .modal-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .modal-form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn-cancelar {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-confirmar {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Tabela de quest√µes */
        .questoes-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .questoes-table th {
            background-color: #f8f9fa;
            padding: 10px;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
            font-weight: bold;
        }
        
        .questoes-table td {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .questoes-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .btn-table {
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            margin-right: 5px;
        }
        
        .btn-excluir {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-ver-sql {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-editar {
            background-color: #ffc107;
            color: #212529;
        }
        
        .btn-abrir {
            background-color: #28a745;
            color: white;
        }
        
        /* Menu da prova - COR AZUL */
        .prova-menu {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            padding: 15px;
            border-radius: 8px;
            color: white;
        }
        
        .prova-info {
            display: flex;
            flex-direction: column;
        }
        
        .prova-nome {
            font-size: 20px;
            font-weight: bold;
            color: white;
        }
        
        .prova-descricao {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        
        .prova-acoes {
            display: flex;
            gap: 10px;
        }
        
        .btn-nova-questao {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-ver-sql-todas {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-voltar-pasta {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Menu da pasta - COR ROXA */
        .pasta-menu {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            padding: 15px;
            border-radius: 8px;
            color: white;
        }
        
        .pasta-info {
            display: flex;
            flex-direction: column;
        }
        
        .pasta-nome {
            font-size: 20px;
            font-weight: bold;
            color: white;
        }
        
        .pasta-descricao {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        
        .pasta-acoes {
            display: flex;
            gap: 10px;
        }
        
        .btn-excluir-pasta {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Breadcrumb */
        .breadcrumb {
            font-size: 14px;
            color: #a3b1c6;
            margin-bottom: 15px;
            padding: 8px;
            background-color: #34495e;
            border-radius: 4px;
        }
        
        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
            cursor: pointer;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb span {
            color: #ecf0f1;
        }

        /* Estilos para o resultado da inser√ß√£o em lote */
        .resultado-insercao {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .resultado-sucesso {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .resultado-erro {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .resultado-item {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 3px;
        }
        
        /* Se√ß√£o de Arquivos */
        .arquivos-container {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .arquivos-container h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .arquivos-lista {
            margin-bottom: 15px;
            min-height: 50px;
            border: 1px dashed #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: #fafafa;
        }
        
        .arquivo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            margin-bottom: 5px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .arquivo-url {
            flex-grow: 1;
            font-size: 14px;
            color: #333;
            word-break: break-all;
        }
        
        .arquivo-acoes {
            display: flex;
            gap: 5px;
        }
        
        .btn-remover-arquivo {
            background: #dc3545;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .arquivos-controles {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .arquivos-controles input {
            flex-grow: 1;
        }
        
        .arquivos-vazio {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                padding: 10px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 5px;
            }
            
            .blocos-na-linha {
                flex-direction: column;
            }
            
            .bloco {
                min-width: 100% !important;
            }
            
            .questoes-table {
                display: block;
                overflow-x: auto;
            }
        }



        select[multiple] {
    height: 220px;
    padding: 8px;
}

select[multiple] option {
    padding: 4px 8px;
    margin: 2px 0;
}

.multi-select-info {
    font-size: 12px;
    color: #666;
    margin-top: 4px;
}
    </style>
</head>
<body>
    <!-- Context Menu -->
    <div id="context-menu" class="context-menu">
        <div class="context-menu-item danger" onclick="removerProva()">Remover Prova</div>
    </div>
    
    <!-- Context Menu para Pasta -->
    <div id="context-menu-pasta" class="context-menu">
        <div class="context-menu-item" onclick="moverPasta()">Mover</div>
        <div class="context-menu-item danger" onclick="removerPasta()">Remover Pasta</div>
    </div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">Editor de Quest√µes</div>
            <div class="sidebar-subtitle">Banco de Dados</div>
        </div>
        
        <div class="sidebar-menu">
            <div class="sidebar-menu-title">Pastas</div>
            <button id="btn-criar-pasta" class="sidebar-button">üìÅ Criar Pasta</button>
            <button id="btn-inserir-sql" class="sidebar-button">üíæ Inserir SQL Direto</button>
        </div>
        
        <ul id="prova-list" class="prova-list">
            <!-- Pastas ser√£o adicionadas aqui dinamicamente -->
        </ul>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Tela de Pasta (Lista de Provas na Pasta) -->
        <div id="tela-pasta" class="editor-container" style="display: none;">
            <div class="breadcrumb" id="breadcrumb-pasta"></div>
            
            <div class="pasta-menu">
                <div class="pasta-info">
                    <div class="pasta-nome" id="pasta-nome-titulo"></div>
                    <div class="pasta-descricao" id="pasta-descricao-titulo"></div>
                </div>
                <div class="pasta-acoes">
                    <button id="btn-nova-prova-pasta" class="btn-nova-questao">+ Nova Prova</button>
                    <button id="btn-excluir-pasta" class="btn-excluir-pasta">Excluir Pasta</button>
                </div>
            </div>
            
            <table class="questoes-table">
                <thead>
                    <tr>
                        <th width="5%">#</th>
                        <th width="35%">Nome da Prova</th>
                        <th width="25%">Descri√ß√£o</th>
                        <th width="10%">Quest√µes</th>
                        <th width="25%">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="provas-pasta-lista">
                    <!-- Provas da pasta ser√£o adicionadas aqui dinamicamente -->
                </tbody>
            </table>
            
            <div id="sem-provas-pasta" style="text-align: center; padding: 20px; color: #666;">
                Nenhuma prova adicionada nesta pasta ainda.
            </div>
        </div>
        
        <!-- Tela de Prova (Lista de Quest√µes) -->
        <div id="tela-prova" class="editor-container" style="display: none;">
            <div class="breadcrumb" id="breadcrumb-prova"></div>
            
            <div class="prova-menu">
                <div class="prova-info">
                    <div class="prova-nome" id="prova-nome-titulo"></div>
                    <div class="prova-descricao" id="prova-descricao-titulo"></div>
                </div>
                <div class="prova-acoes">
                    <button id="btn-voltar-pasta" class="btn-voltar-pasta">‚Üê Voltar para a Pasta</button>
                    <button id="btn-nova-questao" class="btn-nova-questao">+ Nova Quest√£o</button>
                    <button id="btn-ver-sql-todas" class="btn-ver-sql-todas" onclick="mostrarSQLProva()">Ver SQL da Prova</button>
                </div>
            </div>
            
            <table class="questoes-table">
                <thead>
                    <tr>
                        <th width="5%">#</th>
                        <th width="20%">Disciplina</th>
                        <th width="20%">Mat√©ria</th>
                        <th width="20%">Assunto</th>
                        <th width="10%">Resposta</th>
                        <th width="25%">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="questoes-lista">
                    <!-- Quest√µes ser√£o adicionadas aqui dinamicamente -->
                </tbody>
            </table>
            
            <div id="sem-questoes" style="text-align: center; padding: 20px; color: #666;">
                Nenhuma quest√£o adicionada ainda.
            </div>
        </div>
        
        <!-- Tela de Edi√ß√£o de Quest√£o -->
        <div id="tela-questao" class="editor-container">
            <div class="breadcrumb" id="breadcrumb-questao"></div>
            
            <div class="editor-header">
                <div>
                    <div class="editor-title" id="titulo-questao">Adicionar Quest√£o</div>
                    <div class="editor-subtitle">Prova: <span id="prova-selecionada">Nenhuma</span></div>
                </div>
                <div class="action-buttons">
                    <button id="btn-voltar-prova" class="btn-voltar">Voltar para Prova</button>
                    <button onclick="salvarQuestao()" class="btn-salvar" id="btn-salvar-questao">Salvar Quest√£o</button>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="disciplina">Disciplina:</label>
                        <select id="disciplina" class="form-control" multiple onchange="atualizarMaterias()">
    <option value="">Selecione uma ou mais disciplinas</option>
</select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="materia">Mat√©ria:</label>
                        <select id="materia" class="form-control" multiple onchange="atualizarAssuntos()" disabled>
    <option value="">Selecione uma ou mais mat√©rias</option>
</select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="assunto">Assunto:</label>
                        <select id="assunto" class="form-control" multiple onchange="atualizarConteudos()" disabled>
    <option value="">Selecione um ou mais assuntos</option>
</select>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="conteudo">Conte√∫do (opcional):</label>
                        <select id="conteudo" class="form-control" multiple onchange="atualizarTopicos()" disabled>
    <option value="">Selecione um ou mais conte√∫dos</option>
</select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="topico">T√≥pico (opcional):</label>
                        <select id="topico" class="form-control" multiple disabled>
    <option value="">Selecione um ou mais t√≥picos</option>
</select>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="ano">Ano (opcional):</label>
                        <select id="ano" class="form-control">
                            <option value="">Selecione um ano</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                            <option value="2019">2019</option>
                            <option value="2018">2018</option>
                            <option value="2017">2017</option>
                            <option value="2016">2016</option>
                            <option value="2015">2015</option>
                            <option value="2014">2014</option>
                            <option value="2013">2013</option>
                            <option value="2012">2012</option>
                            <option value="2011">2011</option>
                            <option value="2010">2010</option>
                            <option value="2009">2009</option>
                            <option value="2008">2008</option>
                            <option value="2007">2007</option>
                            <option value="2006">2006</option>
                            <option value="2005">2005</option>
                            <option value="2004">2004</option>
                            <option value="2003">2003</option>
                            <option value="2002">2002</option>
                            <option value="2001">2001</option>
                            <option value="2000">2000</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="instituicao">Institui√ß√£o (opcional):</label>
                        <select id="instituicao" class="form-control">
                            <option value="">Selecione uma institui√ß√£o</option>
                            <option value="ENEM">ENEM</option>
                            <option value="FUVEST">FUVEST</option>
                            <option value="UNICAMP">UNICAMP</option>
                            <option value="UNESP">UNESP</option>
                            <option value="PUC-SP">PUC-SP</option>
                            <option value="UERJ">UERJ</option>
                            <option value="UFF">UFF</option>
                            <option value="UFMG">UFMG</option>
                            <option value="UFPR">UFPR</option>
                            <option value="UFRGS">UFRGS</option>
                            <option value="UnB">UnB</option>
                            <option value="UFC">UFC</option>
                            <option value="UFPE">UFPE</option>
                            <option value="UFBA">UFBA</option>
                            <option value="UFSC">UFSC</option>
                            <option value="UFG">UFG</option>
                            <option value="UFES">UFES</option>
                            <option value="UFSM">UFSM</option>
                            <option value="MACKENZIE">MACKENZIE</option>
                            <option value="FGV">FGV</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="resposta">Resposta Correta:</label>
                        <select id="resposta" class="form-control">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Novos campos para conhecimentos -->
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="conhecimento1">Conhecimento 1 (opcional):</label>
                        <select id="conhecimento1" class="form-control">
                            <option value="">Selecione um conhecimento</option>
                            <option value="racioc√≠nio l√≥gico">Racioc√≠nio L√≥gico</option>
                            <option value="interpreta√ß√£o de texto">Interpreta√ß√£o de Texto</option>
                            <option value="an√°lise de gr√°ficos">An√°lise de Gr√°ficos</option>
                            <option value="resolu√ß√£o de problemas">Resolu√ß√£o de Problemas</n>
                            <option value="pensamento cr√≠tico">Pensamento Cr√≠tico</option>
                            <option value="aplica√ß√£o de conceitos">Aplica√ß√£o de Conceitos</option>
                            <option value="s√≠ntese de informa√ß√µes">S√≠ntese de Informa√ß√µes</option>
                            <option value="compara√ß√£o e contraste">Compara√ß√£o e Contraste</option>
                            <option value="an√°lise contextual">An√°lise Contextual</option>
                            <option value="infer√™ncia">Infer√™ncia</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="conhecimento2">Conhecimento 2 (opcional):</label>
                        <select id="conhecimento2" class="form-control">
                            <option value="">Selecione um conhecimento</option>
                            <option value="racioc√≠nio l√≥gico">Racioc√≠nio L√≥gico</option>
                            <option value="interpreta√ß√£o de texto">Interpreta√ß√£o de Texto</option>
                            <option value="an√°lise de gr√°ficos">An√°lise de Gr√°ficos</option>
                            <option value="resolu√ß√£o de problemas">Resolu√ß√£o de Problemas</option>
                            <option value="pensamento cr√≠tico">Pensamento Cr√≠tico</option>
                            <option value="aplica√ß√£o de conceitos">Aplica√ß√£o de Conceitos</option>
                            <option value="s√≠ntese de informa√ß√µes">S√≠ntese de Informa√ß√µes</option>
                            <option value="compara√ß√£o e contraste">Compara√ß√£o e Contraste</option>
                            <option value="an√°lise contextual">An√°lise Contextual</option>
                            <option value="infer√™ncia">Infer√™ncia</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="conhecimento3">Conhecimento 3 (opcional):</label>
                        <select id="conhecimento3" class="form-control">
                            <option value="">Selecione um conhecimento</option>
                            <option value="racioc√≠nio l√≥gico">Racioc√≠nio L√≥gico</option>
                            <option value="interpreta√ß√£o de texto">Interpreta√ß√£o de Texto</option>
                            <option value="an√°lise de gr√°ficos">An√°lise de Gr√°ficos</option>
                            <option value="resolu√ß√£o de problemas">Resolu√ß√£o de Problemas</option>
                            <option value="pensamento cr√≠tico">Pensamento Cr√≠tico</option>
                            <option value="aplica√ß√£o de conceitos">Aplic√ß√£o de Conceitos</option>
                            <option value="s√≠ntese de informa√ß√µes">S√≠ntese de Informa√ß√µes</option>
                            <option value="compara√ß√£o e contraste">Compara√ß√£o e Contraste</option>
                            <option value="an√°lise contextual">An√°lise Contextual</option>
                            <option value="infer√™ncia">Infer√™ncia</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="conhecimento4">Conhecimento 4 (opcional):</label>
                        <select id="conhecimento4" class="form-control">
                            <option value="">Selecione um conhecimento</option>
                            <option value="racioc√≠nio l√≥gico">Racioc√≠nio L√≥gico</option>
                            <option value="interpreta√ß√£o de texto">Interpreta√ß√£o de Texto</option>
                            <option value="an√°lise de gr√°ficos">An√°lise de Gr√°ficos</option>
                            <option value="resolu√ß√£o de problemas">Resolu√ß√£o de Problemas</option>
                            <option value="pensamento cr√≠tico">Pensamento Cr√≠tico</option>
                            <option value="aplica√ß√£o de conceitos">Aplica√ß√£o de Conceitos</option>
                            <option value="s√≠ntese de informa√ß√µes">S√≠ntese de Informa√ß√µes</option>
                            <option value="compara√ß√£o e contraste">Compara√ß√£o e Contraste</option>
                            <option value="an√°lise contextual">An√°lise Contextual</option>
                            <option value="infer√™ncia">Infer√™ncia</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div id="linhas-container" class="linhas-container">
                <!-- Campo para Context (Texto de Apoio) -->
                <div class="linha">
                    <div class="bloco bloco-texto">
                        <div class="bloco-header">
                            <span class="bloco-tipo">Texto de Apoio (Context)</span>
                        </div>
                        <div class="texto-content">
                            <textarea id="context-textarea" placeholder="Digite o texto de apoio/contexto aqui..." style="min-height: 120px; width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; resize: vertical;"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Campo para Enunciado (alternativesIntroduction) -->
                <div class="linha">
                    <div class="bloco bloco-texto">
                        <div class="bloco-header">
                            <span class="bloco-tipo">Enunciado da Quest√£o</span>
                        </div>
                        <div class="texto-content">
                            <textarea id="enunciado-textarea" placeholder="Digite o enunciado da quest√£o aqui..." style="min-height: 80px; width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; resize: vertical;"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="arquivos-container">
                <h3>Imagens (opcional)</h3>
                <div class="arquivos-lista" id="arquivos-lista">
                    <div class="arquivos-vazio">Nenhuma imagem adicionada.</div>
                </div>
                <div class="arquivos-controles">
                    <input type="text" id="input-url-imagem" class="form-control" placeholder="URL da imagem">
                    <button class="btn-salvar" onclick="adicionarImagem()">Adicionar Imagem</button>
                </div>
            </div>

            <div class="alternativas-container">
                <h3>Alternativas</h3>
                <div id="alternativas-lista">
                    <!-- Alternativas ser√£o adicionadas aqui dinamicamente -->
                </div>
                <button class="btn-add-linha" onclick="adicionarAlternativa()">+ Adicionar Alternativa</button>
            </div>

            <div class="action-buttons">
                <button id="btn-voltar-prova-bottom" class="btn-voltar">Voltar para Prova</button>
                <button onclick="salvarQuestao()" class="btn-salvar">Salvar Quest√£o</button>
            </div>
        </div>

        <!-- Modal de Visualiza√ß√£o de SQL -->
        <div id="modal-sql" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModalSQL()">&times;</span>
                <h2>SQL Gerado</h2>
                <div class="preview-area">
                    <pre><code id="codigo-gerado"></code></pre>
                </div>
                <button class="btn-copiar" onclick="copiarSQL()">Copiar</button>
            </div>
        </div>

        <!-- Modal de Criar Pasta -->
        <div id="modal-criar-pasta" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModalCriarPasta()">&times;</span>
                <h2>Criar Nova Pasta</h2>
                <div class="modal-form">
                    <div class="modal-form-group">
                        <label for="nome-pasta">Nome da Pasta:</label>
                        <input type="text" id="nome-pasta" placeholder="Ex: Enem 2023">
                    </div>
                    <div class="modal-form-group">
                        <label for="descricao-pasta">Descri√ß√£o (opcional):</label>
                        <input type="text" id="descricao-pasta" placeholder="Ex: Provas do Enem de 2023">
                    </div>
                    <div class="modal-form-group">
                        <label for="parent-pasta">Pasta Pai (opcional):</label>
                        <select id="parent-pasta" class="form-control">
                            <option value="">Nenhuma (Pasta Raiz)</option>
                        </select>
                    </div>
                    <div class="modal-buttons">
                        <button class="btn-cancelar" onclick="fecharModalCriarPasta()">Cancelar</button>
                        <button class="btn-confirmar" onclick="criarPasta()">Criar Pasta</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Criar Prova -->
        <div id="modal-criar-prova" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModalCriarProva()">&times;</span>
                <h2>Criar Nova Prova</h2>
                <div class="modal-form">
                    <div class="modal-form-group">
                        <label for="titulo-prova">T√≠tulo da Prova:</label>
                        <input type="text" id="titulo-prova" placeholder="Ex: Enem 2023 - Primeiro Dia">
                    </div>
                    <div class="modal-form-group">
                        <label for="descricao-prova">Descri√ß√£o (opcional):</label>
                        <input type="text" id="descricao-prova" placeholder="Ex: Prova do Enem 2023 - Quest√µes 1 a 45">
                    </div>
                    <div class="modal-buttons">
                        <button class="btn-cancelar" onclick="fecharModalCriarProva()">Cancelar</button>
                        <button class="btn-confirmar" onclick="criarProva()">Criar Prova</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Inser√ß√£o SQL Direta -->
        <div id="modal-inserir-sql" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModalInserirSQL()">&times;</span>
                <h2>Inserir Quest√µes via SQL Direto</h2>
                <div class="modal-form">
                    <div class="modal-form-group">
                        <label for="sql-input">Cole o JSON das quest√µes aqui:</label>
                        <textarea id="sql-input" class="form-control" rows="10" placeholder="[{ \"index\": 1, \"year\": 2023, ... }, { ... }]"></textarea>
                    </div>
                    <div class="modal-buttons">
                        <button class="btn-cancelar" onclick="fecharModalInserirSQL()">Cancelar</button>
                        <button class="btn-confirmar" onclick="inserirSQLDireto()">Inserir Quest√µes</button>
                    </div>
                </div>
                <div id="resultado-insercao" class="resultado-insercao" style="display: none;">
                    <h3>Resultado da Inser√ß√£o:</h3>
                    <div id="resultado-lista"></div>
                </div>
            </div>
        </div>

        <!-- Modal de Mover Pasta -->
        <div id="modal-mover-pasta" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModalMoverPasta()">&times;</span>
                <h2>Mover Pasta</h2>
                <div class="modal-form">
                    <div class="modal-form-group">
                        <label for="destino-pasta">Mover para:</label>
                        <select id="destino-pasta" class="form-control">
                            <option value="">Nenhuma (Pasta Raiz)</option>
                        </select>
                    </div>
                    <div class="modal-buttons">
                        <button class="btn-cancelar" onclick="fecharModalMoverPasta()">Cancelar</button>
                        <button class="btn-confirmar" onclick="confirmarMoverPasta()">Mover</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : 'https://repositoriodequestoes.com/api';
        let currentProvaId = null;
        let currentPastaId = null;
        let currentQuestaoId = null;
        let currentPastaParentId = null;

        // Dados para os selects hier√°rquicos
        const dadosHierarquicos = {
            "Ci√™ncias da Natureza": {
                "Qu√≠mica": {
                    "Atom√≠stica": ["Modelos At√¥micos", "Estrutura do √Åtomo"],
                    "Liga√ß√µes Qu√≠micas": ["I√¥nicas", "Covalentes", "Met√°licas"],
                    "Rea√ß√µes Qu√≠micas": ["Balanceamento", "Estequiometria"]
                },
                "F√≠sica": {
                    "Mec√¢nica": ["Cinem√°tica", "Din√¢mica", "Est√°tica"],
                    "Termodin√¢mica": ["Calor", "Temperatura", "Leis da Termodin√¢mica"]
                },
                "Biologia": {
                    "Ecologia": ["Cadeias Alimentares", "Ciclos Biogeoqu√≠micos"],
                    "Gen√©tica": ["Leis de Mendel", "DNA e RNA"]
                }
            },
            "Ci√™ncias Humanas": {
                "Hist√≥ria": {
                    "Antiguidade": ["Gr√©cia Antiga", "Roma Antiga"],
                    "Idade M√©dia": ["Feudalismo", "Cruzadas"]
                },
                "Geografia": {
                    "Geografia F√≠sica": ["Clima", "Relevo"],
                    "Geografia Humana": ["Popula√ß√£o", "Urbaniza√ß√£o"]
                }
            },
            "Linguagens": {
                "Portugu√™s": {
                    "Gram√°tica": ["Morfologia", "Sintaxe"],
                    "Literatura": ["Romantismo", "Modernismo"]
                },
                "Ingl√™s": {
                    "Grammar": ["Verb Tenses", "Modals"],
                    "Vocabulary": ["Phrasal Verbs", "Idioms"]
                }
            },
            "Matem√°tica": {
                "√Ålgebra": {
                    "Equa√ß√µes": ["1¬∫ Grau", "2¬∫ Grau"],
                    "Fun√ß√µes": ["Afim", "Quadr√°tica"]
                },
                "Geometria": {
                    "Plana": ["√Åreas", "Per√≠metros"],
                    "Espacial": ["Volumes", "Superf√≠cies"]
                }
            }
        };

        // Elementos do DOM
        const provaList = document.getElementById("prova-list");
        const telaPasta = document.getElementById("tela-pasta");
        const telaProva = document.getElementById("tela-prova");
        const telaQuestao = document.getElementById("tela-questao");
        const pastaNomeTitulo = document.getElementById("pasta-nome-titulo");
        const pastaDescricaoTitulo = document.getElementById("pasta-descricao-titulo");
        const provasPastaLista = document.getElementById("provas-pasta-lista");
        const semProvasPasta = document.getElementById("sem-provas-pasta");
        const provaNomeTitulo = document.getElementById("prova-nome-titulo");
        const provaDescricaoTitulo = document.getElementById("prova-descricao-titulo");
        const questoesLista = document.getElementById("questoes-lista");
        const semQuestoes = document.getElementById("sem-questoes");
        const tituloQuestao = document.getElementById("titulo-questao");
        const provaSelecionadaSpan = document.getElementById("prova-selecionada");
        const btnVoltarProva = document.getElementById("btn-voltar-prova");
        const btnVoltarProvaBottom = document.getElementById("btn-voltar-prova-bottom");
        const btnVoltarPasta = document.getElementById("btn-voltar-pasta");
        const btnNovaQuestao = document.getElementById("btn-nova-questao");
        const btnNovaProvaPasta = document.getElementById("btn-nova-prova-pasta");
        const btnExcluirPasta = document.getElementById("btn-excluir-pasta");
        const btnCriarPasta = document.getElementById("btn-criar-pasta");
        const btnInserirSQL = document.getElementById("btn-inserir-sql");
        const breadcrumbPasta = document.getElementById("breadcrumb-pasta");
        const breadcrumbProva = document.getElementById("breadcrumb-prova");
        const breadcrumbQuestao = document.getElementById("breadcrumb-questao");

        // Campos do formul√°rio de quest√£o
        const selectDisciplina = document.getElementById("disciplina");
        const selectMateria = document.getElementById("materia");
        const selectAssunto = document.getElementById("assunto");
        const selectConteudo = document.getElementById("conteudo");
        const selectTopico = document.getElementById("topico");
        const inputAno = document.getElementById("ano");
        const inputInstituicao = document.getElementById("instituicao");
        const selectResposta = document.getElementById("resposta");
        const inputContext = document.getElementById("context-textarea");
        const inputEnunciado = document.getElementById("enunciado-textarea");
        const alternativasLista = document.getElementById("alternativas-lista");
        const arquivosLista = document.getElementById("arquivos-lista");
        const inputUrlImagem = document.getElementById("input-url-imagem");
        const conhecimento1 = document.getElementById("conhecimento1");
        const conhecimento2 = document.getElementById("conhecimento2");
        const conhecimento3 = document.getElementById("conhecimento3");
        const conhecimento4 = document.getElementById("conhecimento4");

        // Modais
        const modalSQL = document.getElementById("modal-sql");
        const codigoGerado = document.getElementById("codigo-gerado");
        const modalCriarPasta = document.getElementById("modal-criar-pasta");
        const inputNomePasta = document.getElementById("nome-pasta");
        const inputDescricaoPasta = document.getElementById("descricao-pasta");
        const selectParentPasta = document.getElementById("parent-pasta");
        const modalCriarProva = document.getElementById("modal-criar-prova");
        const inputTituloProva = document.getElementById("titulo-prova");
        const inputDescricaoProva = document.getElementById("descricao-prova");
        const modalInserirSQL = document.getElementById("modal-inserir-sql");
        const sqlInput = document.getElementById("sql-input");
        const resultadoInsercaoDiv = document.getElementById("resultado-insercao");
        const resultadoListaDiv = document.getElementById("resultado-lista");
        const modalMoverPasta = document.getElementById("modal-mover-pasta");
        const selectDestinoPasta = document.getElementById("destino-pasta");

        // Context Menus
        const contextMenu = document.getElementById("context-menu");
        const contextMenuPasta = document.getElementById("context-menu-pasta");
        let provaContextMenuId = null;
        let pastaContextMenuId = null;

        // Fun√ß√µes de utilidade
        function showLoading() {
            // Implementar um spinner ou mensagem de carregamento
            console.log("Carregando...");
        }

        function hideLoading() {
            // Esconder spinner/mensagem
            console.log("Carregamento conclu√≠do.");
        }

        function showToast(message, type = "success") {
            // Implementar um toast notification
            console.log(`Toast (${type}): ${message}`);
            alert(message); // Tempor√°rio
        }

        // Navega√ß√£o
        function showScreen(screenId) {
            telaPasta.style.display = "none";
            telaProva.style.display = "none";
            telaQuestao.style.display = "none";
            document.getElementById(screenId).style.display = "block";
        }

        function goToHome() {
            currentPastaId = null;
            currentProvaId = null;
            currentQuestaoId = null;
            renderSidebar();
            showScreen("tela-questao"); // Ou uma tela inicial vazia
            resetForm();
            tituloQuestao.textContent = "Adicionar Quest√£o";
            provaSelecionadaSpan.textContent = "Nenhuma";
            breadcrumbQuestao.innerHTML = "";
        }

        function goToPasta(pastaId) {
            currentPastaId = pastaId;
            currentProvaId = null;
            currentQuestaoId = null;
            renderPastaScreen(pastaId);
            showScreen("tela-pasta");
        }

        function goToProva(provaId) {
            currentProvaId = provaId;
            currentQuestaoId = null;
            renderProvaScreen(provaId);
            showScreen("tela-prova");
        }

        function goToQuestao(questaoId = null) {
            currentQuestaoId = questaoId;
            resetForm();
            if (questaoId) {
                tituloQuestao.textContent = "Editar Quest√£o";
                carregarQuestaoParaEdicao(questaoId);
            } else {
                tituloQuestao.textContent = "Adicionar Quest√£o";
                provaSelecionadaSpan.textContent = currentProvaId ? `ID: ${currentProvaId}` : "Nenhuma";
            }
            updateBreadcrumbQuestao();
            showScreen("tela-questao");
        }

        // Breadcrumbs
        async function updateBreadcrumbPasta() {
            let breadcrumbHtml = 
                `<a href="#" onclick="goToHome()">In√≠cio</a> > `;
            if (currentPastaId) {
                const pasta = await fetchPasta(currentPastaId);
                if (pasta) {
                    const path = await getPastaPath(pasta);
                    path.forEach((p, index) => {
                        breadcrumbHtml += 
                            `<a href="#" onclick="goToPasta(\'${p._id}\')">${p.nome}</a>${index < path.length - 1 ? ' > ' : ''}`;
                    });
                }
            }
            breadcrumbPasta.innerHTML = breadcrumbHtml;
        }

        async function updateBreadcrumbProva() {
            let breadcrumbHtml = 
                `<a href="#" onclick="goToHome()">In√≠cio</a> > `;
            if (currentPastaId) {
                const pasta = await fetchPasta(currentPastaId);
                if (pasta) {
                    const path = await getPastaPath(pasta);
                    path.forEach((p, index) => {
                        breadcrumbHtml += 
                            `<a href="#" onclick="goToPasta(\'${p._id}\')">${p.nome}</a> > `;
                    });
                }
            }
            if (currentProvaId) {
                const prova = await fetchProva(currentProvaId);
                if (prova) {
                    breadcrumbHtml += 
                        `<span>${prova.titulo}</span>`;
                }
            }
            breadcrumbProva.innerHTML = breadcrumbHtml;
        }

        async function updateBreadcrumbQuestao() {
            let breadcrumbHtml = 
                `<a href="#" onclick="goToHome()">In√≠cio</a> > `;
            if (currentPastaId) {
                const pasta = await fetchPasta(currentPastaId);
                if (pasta) {
                    const path = await getPastaPath(pasta);
                    path.forEach((p, index) => {
                        breadcrumbHtml += 
                            `<a href="#" onclick="goToPasta(\'${p._id}\')">${p.nome}</a> > `;
                    });
                }
            }
            if (currentProvaId) {
                const prova = await fetchProva(currentProvaId);
                if (prova) {
                    breadcrumbHtml += 
                        `<a href="#" onclick="goToProva(\'${prova._id}\')">${prova.titulo}</a> > `;
                }
            }
            if (currentQuestaoId) {
                const questao = await fetchQuestao(currentQuestaoId);
                if (questao) {
                    breadcrumbHtml += 
                        `<span>Quest√£o ${questao.index || questao._id.substring(0, 4)}</span>`;
                }
            } else {
                breadcrumbHtml += 
                    `<span>Nova Quest√£o</span>`;
            }
            breadcrumbQuestao.innerHTML = breadcrumbHtml;
        }

        async function getPastaPath(pasta) {
            const path = [];
            let current = pasta;
            while (current) {
                path.unshift(current);
                if (current.parent) {
                    current = await fetchPasta(current.parent);
                } else {
                    current = null;
                }
            }
            return path;
        }

        // API Calls
        async function fetchData(endpoint) {
            showLoading();
            try {
                const response = await fetch(`${API_URL}/${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error("Erro ao buscar dados:", error);
                showToast(`Erro ao carregar dados: ${error.message}`, "error");
                return null;
            } finally {
                hideLoading();
            }
        }

        async function postData(endpoint, data) {
            showLoading();
            try {
                const response = await fetch(`${API_URL}/${endpoint}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error("Erro ao enviar dados:", error);
                showToast(`Erro ao salvar dados: ${error.message}`, "error");
                return null;
            } finally {
                hideLoading();
            }
        }

        async function putData(endpoint, data) {
            showLoading();
            try {
                const response = await fetch(`${API_URL}/${endpoint}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error("Erro ao atualizar dados:", error);
                showToast(`Erro ao atualizar dados: ${error.message}`, "error");
                return null;
            } finally {
                hideLoading();
            }
        }

        async function deleteData(endpoint) {
            showLoading();
            try {
                const response = await fetch(`${API_URL}/${endpoint}`, {
                    method: "DELETE",
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error("Erro ao deletar dados:", error);
                showToast(`Erro ao deletar dados: ${error.message}`, "error");
                return null;
            } finally {
                hideLoading();
            }
        }

        async function fetchPastas() {
            return fetchData("pastas");
        }

        async function fetchPasta(id) {
            return fetchData(`pastas/${id}`);
        }

        async function fetchProvas(pastaId = null) {
            const endpoint = pastaId ? `pastas/${pastaId}?populate=provas` : "provas";
            const data = await fetchData(endpoint);
            return pastaId ? data.provas : data;
        }

        async function fetchProva(id) {
            return fetchData(`provas/${id}?populate=questoes`);
        }

        async function fetchQuestoes(provaId = null) {
            const endpoint = provaId ? `provas/${provaId}?populate=questoes` : "questoes";
            const data = await fetchData(endpoint);
            return provaId ? data.questoes : data;
        }

        async function fetchQuestao(id) {
            return fetchData(`questoes/${id}`);
        }

        // Renderiza√ß√£o da Sidebar
        async function renderSidebar() {
            provaList.innerHTML = "";
            const pastas = await fetchPastas();
            if (pastas) {
                const rootPastas = pastas.filter(p => !p.parent);
                rootPastas.forEach(pasta => renderPastaItem(pasta, 0));
            }
        }

        function renderPastaItem(pasta, level) {
            const li = document.createElement("li");
            li.className = "prova-item pasta-item";
            li.style.paddingLeft = `${10 + level * 15}px`;
            li.innerHTML = `
                <span class="pasta-icon">üìÅ</span>
                <span class="pasta-nome-item">${pasta.nome}</span>
                <span class="prova-item-count">${pasta.provas.length}</span>
            `;
            li.onclick = (event) => {
                if (!event.target.classList.contains("context-menu-trigger")) {
                    goToPasta(pasta._id);
                }
            };
            li.oncontextmenu = (event) => {
                event.preventDefault();
                pastaContextMenuId = pasta._id;
                showContextMenu(event, contextMenuPasta);
            };
            provaList.appendChild(li);

            if (pasta.children && pasta.children.length > 0) {
                pasta.children.sort((a, b) => a.nome.localeCompare(b.nome));
                pasta.children.forEach(childId => {
                    // Encontrar a pasta completa pelo ID do child
                    const childPasta = pastas.find(p => p._id === childId);
                    if (childPasta) {
                        renderPastaItem(childPasta, level + 1);
                    }
                });
            }

            if (pasta.provas && pasta.provas.length > 0) {
                pasta.provas.sort((a, b) => a.titulo.localeCompare(b.titulo));
                pasta.provas.forEach(prova => renderProvaItem(prova, level + 1));
            }
        }

        function renderProvaItem(prova, level) {
            const li = document.createElement("li");
            li.className = "prova-item";
            li.style.paddingLeft = `${10 + level * 15}px`;
            li.innerHTML = `
                <span>üìÑ ${prova.titulo}</span>
                <span class="prova-item-count">${prova.questoes.length}</span>
            `;
            li.onclick = (event) => {
                if (!event.target.classList.contains("context-menu-trigger")) {
                    goToProva(prova._id);
                }
            };
            li.oncontextmenu = (event) => {
                event.preventDefault();
                provaContextMenuId = prova._id;
                showContextMenu(event, contextMenu);
            };
            provaList.appendChild(li);
        }

        // Renderiza√ß√£o da Tela de Pasta
        async function renderPastaScreen(pastaId) {
            const pasta = await fetchPasta(pastaId);
            if (pasta) {
                pastaNomeTitulo.textContent = pasta.nome;
                pastaDescricaoTitulo.textContent = pasta.descricao || "";
                
                provasPastaLista.innerHTML = "";
                if (pasta.provas && pasta.provas.length > 0) {
                    semProvasPasta.style.display = "none";
                    pasta.provas.forEach((prova, index) => {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${prova.titulo}</td>
                            <td>${prova.descricao || "-"}</td>
                            <td>${prova.questoes.length}</td>
                            <td>
                                <button class="btn-table btn-abrir" onclick="goToProva(\'${prova._id}\')">Abrir</button>
                                <button class="btn-table btn-editar" onclick="editarProva(\'${prova._id}\')">Editar</button>
                                <button class="btn-table btn-excluir" onclick="removerProva(\'${prova._id}\')">Excluir</button>
                            </td>
                        `;
                        provasPastaLista.appendChild(tr);
                    });
                } else {
                    semProvasPasta.style.display = "block";
                }
                currentPastaParentId = pasta.parent; // Armazenar o parent da pasta atual
            }
            updateBreadcrumbPasta();
        }

        // Renderiza√ß√£o da Tela de Prova
        async function renderProvaScreen(provaId) {
            const prova = await fetchProva(provaId);
            if (prova) {
                provaNomeTitulo.textContent = prova.titulo;
                provaDescricaoTitulo.textContent = prova.descricao || "";
                
                questoesLista.innerHTML = "";
                if (prova.questoes && prova.questoes.length > 0) {
                    semQuestoes.style.display = "none";
                    prova.questoes.forEach((questao, index) => {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                            <td>${questao.index || index + 1}</td>
                            <td>${questao.disciplina ? questao.disciplina.join(', ') : '-'}</td>
                            <td>${questao.materia ? questao.materia.join(', ') : '-'}</td>
                            <td>${questao.assunto ? questao.assunto.join(', ') : '-'}</td>
                            <td>${questao.resposta}</td>
                            <td>
                                <button class="btn-table btn-abrir" onclick="goToQuestao(\'${questao._id}\')">Ver/Editar</button>
                                <button class="btn-table btn-ver-sql" onclick="mostrarSQLQuestao(\'${questao._id}\')">Ver SQL</button>
                                <button class="btn-table btn-excluir" onclick="removerQuestao(\'${questao._id}\')">Excluir</button>
                            </td>
                        `;
                        questoesLista.appendChild(tr);
                    });
                } else {
                    semQuestoes.style.display = "block";
                }
            }
            updateBreadcrumbProva();
        }

        // Fun√ß√µes de Formul√°rio de Quest√£o
        function resetForm() {
            currentQuestaoId = null;
            selectDisciplina.value = "";
            selectMateria.value = "";
            selectAssunto.value = "";
            selectConteudo.value = "";
            selectTopico.value = "";
            inputAno.value = "";
            inputInstituicao.value = "";
            selectResposta.value = "A";
            inputContext.value = "";
            inputEnunciado.value = "";
            alternativasLista.innerHTML = "";
            arquivosLista.innerHTML = `<div class="arquivos-vazio">Nenhuma imagem adicionada.</div>`;
            inputUrlImagem.value = "";
            conhecimento1.value = "";
            conhecimento2.value = "";
            conhecimento3.value = "";
            conhecimento4.value = "";

            // Resetar selects m√∫ltiplos
            Array.from(selectDisciplina.options).forEach(option => option.selected = false);
            Array.from(selectMateria.options).forEach(option => option.selected = false);
            Array.from(selectAssunto.options).forEach(option => option.selected = false);
            Array.from(selectConteudo.options).forEach(option => option.selected = false);
            Array.from(selectTopico.options).forEach(option => option.selected = false);

            // Desabilitar selects dependentes
            selectMateria.disabled = true;
            selectAssunto.disabled = true;
            selectConteudo.disabled = true;
            selectTopico.disabled = true;

            // Adicionar alternativas padr√£o
            adicionarAlternativa("A");
            adicionarAlternativa("B");
            adicionarAlternativa("C");
            adicionarAlternativa("D");
            adicionarAlternativa("E");
        }

        async function carregarQuestaoParaEdicao(id) {
            const questao = await fetchQuestao(id);
            if (questao) {
                // Preencher selects hier√°rquicos
                if (questao.disciplina && questao.disciplina.length > 0) {
                    populateSelect(selectDisciplina, Object.keys(dadosHierarquicos), questao.disciplina);
                    atualizarMaterias(questao.materia);
                }
                if (questao.materia && questao.materia.length > 0) {
                    atualizarAssuntos(questao.assunto);
                }
                if (questao.assunto && questao.assunto.length > 0) {
                    atualizarConteudos(questao.conteudo);
                }
                if (questao.conteudo && questao.conteudo.length > 0) {
                    atualizarTopicos(questao.topico);
                }

                inputAno.value = questao.ano || "";
                inputInstituicao.value = questao.instituicao || "";
                selectResposta.value = questao.resposta || "A";
                inputContext.value = questao.context || "";
                inputEnunciado.value = questao.enunciado || "";

                // Conhecimentos
                conhecimento1.value = questao.conhecimento1 || "";
                conhecimento2.value = questao.conhecimento2 || "";
                conhecimento3.value = questao.conhecimento3 || "";
                conhecimento4.value = questao.conhecimento4 || "";

                // Alternativas
                alternativasLista.innerHTML = "";
                questao.alternativas.forEach(alt => {
                    adicionarAlternativa(alt.letter, alt.text);
                });

                // Imagens
                arquivosLista.innerHTML = "";
                if (questao.img1) adicionarImagem(questao.img1);
                if (questao.img2) adicionarImagem(questao.img2);
                if (questao.img3) adicionarImagem(questao.img3);

                // Atualizar span da prova
                if (questao.prova) {
                    const prova = await fetchProva(questao.prova);
                    if (prova) {
                        provaSelecionadaSpan.textContent = prova.titulo;
                        currentProvaId = prova._id;
                        currentPastaId = prova.pasta;
                    }
                }
            }
        }

        async function salvarQuestao() {
            const disciplina = getSelectedOptions(selectDisciplina);
            const materia = getSelectedOptions(selectMateria);
            const assunto = getSelectedOptions(selectAssunto);
            const conteudo = getSelectedOptions(selectConteudo);
            const topico = getSelectedOptions(selectTopico);

            const alternativas = Array.from(alternativasLista.children).map(item => ({
                letter: item.querySelector(".alternativa-letra").textContent.trim(),
                text: item.querySelector(".alternativa-input").value,
                isCorrect: false // Ser√° definido pelo campo resposta
            }));

            const imagens = Array.from(arquivosLista.children).map(item => 
                item.querySelector(".arquivo-url").textContent.trim()
            );

            const questaoData = {
                disciplina: disciplina,
                materia: materia,
                assunto: assunto,
                conteudo: conteudo,
                topico: topico,
                ano: inputAno.value ? parseInt(inputAno.value) : undefined,
                instituicao: inputInstituicao.value || undefined,
                context: inputContext.value || undefined,
                enunciado: inputEnunciado.value,
                alternativas: alternativas,
                resposta: selectResposta.value,
                prova: currentProvaId,
                img1: imagens[0] || undefined,
                img2: imagens[1] || undefined,
                img3: imagens[2] || undefined,
                conhecimento1: conhecimento1.value || undefined,
                conhecimento2: conhecimento2.value || undefined,
                conhecimento3: conhecimento3.value || undefined,
                conhecimento4: conhecimento4.value || undefined,
            };

            let result;
            if (currentQuestaoId) {
                result = await putData(`questoes/${currentQuestaoId}`, questaoData);
            } else {
                result = await postData("questoes", questaoData);
            }

            if (result) {
                showToast("Quest√£o salva com sucesso!");
                if (currentProvaId) {
                    goToProva(currentProvaId);
                } else {
                    goToHome();
                }
            }
        }

        function adicionarAlternativa(letter = null, text = "") {
            const currentCount = alternativasLista.children.length;
            const newLetter = letter || String.fromCharCode(65 + currentCount);

            const div = document.createElement("div");
            div.className = "alternativa-item";
            div.innerHTML = `
                <span class="alternativa-letra">${newLetter})</span>
                <input type="text" class="alternativa-input" value="${text}" placeholder="Texto da alternativa ${newLetter}">
                <button class="btn-remover-alternativa" onclick="removerAlternativa(this)">X</button>
            `;
            alternativasLista.appendChild(div);
        }

        function removerAlternativa(button) {
            button.parentElement.remove();
            // Reorganizar letras
            Array.from(alternativasLista.children).forEach((item, index) => {
                item.querySelector(".alternativa-letra").textContent = String.fromCharCode(65 + index) + ")";
            });
        }

        function adicionarImagem(url = null) {
            const imageUrl = url || inputUrlImagem.value.trim();
            if (!imageUrl) return;

            if (arquivosLista.querySelector(".arquivos-vazio")) {
                arquivosLista.innerHTML = "";
            }

            const div = document.createElement("div");
            div.className = "arquivo-item";
            div.innerHTML = `
                <span class="arquivo-url">${imageUrl}</span>
                <div class="arquivo-acoes">
                    <button class="btn-remover-arquivo" onclick="removerImagem(this)">X</button>
                </div>
            `;
            arquivosLista.appendChild(div);
            inputUrlImagem.value = "";
        }

        function removerImagem(button) {
            button.parentElement.parentElement.remove();
            if (arquivosLista.children.length === 0) {
                arquivosLista.innerHTML = `<div class="arquivos-vazio">Nenhuma imagem adicionada.</div>`;
            }
        }

        // Fun√ß√µes para selects hier√°rquicos
        function populateSelect(selectElement, options, selectedValues = []) {
            selectElement.innerHTML = "";
            const defaultOption = document.createElement("option");
            defaultOption.value = "";
            defaultOption.textContent = `Selecione uma ou mais ${selectElement.id === 'disciplina' ? 'disciplinas' : selectElement.id === 'materia' ? 'mat√©rias' : selectElement.id === 'assunto' ? 'assuntos' : selectElement.id === 'conteudo' ? 'conte√∫dos' : 't√≥picos'}`;
            selectElement.appendChild(defaultOption);

            options.forEach(optionText => {
                const option = document.createElement("option");
                option.value = optionText;
                option.textContent = optionText;
                if (selectedValues.includes(optionText)) {
                    option.selected = true;
                }
                selectElement.appendChild(option);
            });
            selectElement.disabled = options.length === 0;
        }

        function getSelectedOptions(selectElement) {
            return Array.from(selectElement.selectedOptions).map(option => option.value).filter(value => value !== "");
        }

        function atualizarMaterias(selectedMaterias = []) {
            const selectedDisciplinas = getSelectedOptions(selectDisciplina);
            let materiasDisponiveis = new Set();

            selectedDisciplinas.forEach(disciplina => {
                if (dadosHierarquicos[disciplina]) {
                    Object.keys(dadosHierarquicos[disciplina]).forEach(materia => materiasDisponiveis.add(materia));
                }
            });
            populateSelect(selectMateria, Array.from(materiasDisponiveis), selectedMaterias);
            atualizarAssuntos(); // Limpar ou atualizar assuntos ao mudar mat√©rias
        }

        function atualizarAssuntos(selectedAssuntos = []) {
            const selectedDisciplinas = getSelectedOptions(selectDisciplina);
            const selectedMaterias = getSelectedOptions(selectMateria);
            let assuntosDisponiveis = new Set();

            selectedDisciplinas.forEach(disciplina => {
                selectedMaterias.forEach(materia => {
                    if (dadosHierarquicos[disciplina] && dadosHierarquicos[disciplina][materia]) {
                        Object.keys(dadosHierarquicos[disciplina][materia]).forEach(assunto => assuntosDisponiveis.add(assunto));
                    }
                });
            });
            populateSelect(selectAssunto, Array.from(assuntosDisponiveis), selectedAssuntos);
            atualizarConteudos(); // Limpar ou atualizar conte√∫dos ao mudar assuntos
        }

        function atualizarConteudos(selectedConteudos = []) {
            const selectedDisciplinas = getSelectedOptions(selectDisciplina);
            const selectedMaterias = getSelectedOptions(selectMateria);
            const selectedAssuntos = getSelectedOptions(selectAssunto);
            let conteudosDisponiveis = new Set();

            selectedDisciplinas.forEach(disciplina => {
                selectedMaterias.forEach(materia => {
                    selectedAssuntos.forEach(assunto => {
                        if (dadosHierarquicos[disciplina] && dadosHierarquicos[disciplina][materia] && dadosHierarquicos[disciplina][materia][assunto]) {
                            dadosHierarquicos[disciplina][materia][assunto].forEach(conteudo => conteudosDisponiveis.add(conteudo));
                        }
                    });
                });
            });
            populateSelect(selectConteudo, Array.from(conteudosDisponiveis), selectedConteudos);
            atualizarTopicos(); // Limpar ou atualizar t√≥picos ao mudar conte√∫dos
        }

        function atualizarTopicos(selectedTopicos = []) {
            const selectedDisciplinas = getSelectedOptions(selectDisciplina);
            const selectedMaterias = getSelectedOptions(selectMateria);
            const selectedAssuntos = getSelectedOptions(selectAssunto);
            const selectedConteudos = getSelectedOptions(selectConteudo);
            let topicosDisponiveis = new Set();

            // A l√≥gica para t√≥picos √© um pouco diferente, pois eles s√£o o √∫ltimo n√≠vel.
            // Se um conte√∫do for selecionado, os t√≥picos s√£o os do conte√∫do.
            // Se n√£o, mas um assunto for selecionado, os t√≥picos s√£o os dos assuntos.
            // Por simplicidade, vamos considerar que t√≥picos s√£o filhos diretos de conte√∫dos.

            selectedDisciplinas.forEach(disciplina => {
                selectedMaterias.forEach(materia => {
                    selectedAssuntos.forEach(assunto => {
                        selectedConteudos.forEach(conteudo => {
                            // No seu modelo, t√≥picos s√£o o √∫ltimo n√≠vel dentro de conte√∫do.
                            // Se o 'conteudo' j√° √© o array final, ent√£o n√£o h√° mais um n√≠vel para 'topico'.
                            // Assumindo que 'topico' seria um sub-item de 'conteudo' se existisse.
                            // Como n√£o h√° um n√≠vel 'topico' expl√≠cito no `dadosHierarquicos` fornecido,
                            // vamos popular o select de t√≥picos com os pr√≥prios conte√∫dos selecionados, se for o caso,
                            // ou deixar vazio se n√£o houver um n√≠vel mais profundo.
                            // Para este exemplo, vou deixar o select de t√≥picos vazio ou com uma mensagem indicativa.
                            // Se voc√™ tiver dados para t√≥picos, precisar√° estender `dadosHierarquicos`.
                        });
                    });
                });
            });
            // Por enquanto, o select de t√≥picos ser√° populado com base nos conte√∫dos, se houver uma estrutura para isso.
            // Como o `dadosHierarquicos` n√£o tem um n√≠vel 'topico' expl√≠cito, ele ficar√° vazio por padr√£o.
            populateSelect(selectTopico, [], selectedTopicos);
        }

        // Inicializar selects hier√°rquicos
        populateSelect(selectDisciplina, Object.keys(dadosHierarquicos));

        // Event Listeners para bot√µes de navega√ß√£o
        btnVoltarProva.addEventListener("click", () => goToProva(currentProvaId));
        btnVoltarProvaBottom.addEventListener("click", () => goToProva(currentProvaId));
        btnVoltarPasta.addEventListener("click", () => goToPasta(currentPastaId));
        btnNovaQuestao.addEventListener("click", () => goToQuestao());
        btnNovaProvaPasta.addEventListener("click", abrirModalCriarProva);
        btnExcluirPasta.addEventListener("click", () => removerPasta(currentPastaId));
        btnCriarPasta.addEventListener("click", abrirModalCriarPasta);
        btnInserirSQL.addEventListener("click", abrirModalInserirSQL);

        // Fun√ß√µes para Modais
        function abrirModalSQL() {
            modalSQL.style.display = "block";
        }

        function fecharModalSQL() {
            modalSQL.style.display = "none";
            codigoGerado.textContent = "";
        }

        function copiarSQL() {
            navigator.clipboard.writeText(codigoGerado.textContent);
            showToast("SQL copiado para a √°rea de transfer√™ncia!");
        }

        function abrirModalCriarPasta() {
            inputNomePasta.value = "";
            inputDescricaoPasta.value = "";
            populateParentPastaSelect();
            modalCriarPasta.style.display = "block";
        }

        function fecharModalCriarPasta() {
            modalCriarPasta.style.display = "none";
        }

        async function populateParentPastaSelect() {
            selectParentPasta.innerHTML = 
                `<option value="">Nenhuma (Pasta Raiz)</option>`;
            const pastas = await fetchPastas();
            if (pastas) {
                pastas.forEach(pasta => {
                    const option = document.createElement("option");
                    option.value = pasta._id;
                    option.textContent = pasta.nome;
                    selectParentPasta.appendChild(option);
                });
            }
        }

        async function criarPasta() {
            const nome = inputNomePasta.value.trim();
            const descricao = inputDescricaoPasta.value.trim();
            const parent = selectParentPasta.value || null;

            if (!nome) {
                showToast("O nome da pasta √© obrigat√≥rio!", "error");
                return;
            }

            const novaPasta = await postData("pastas", { nome, descricao, parent });
            if (novaPasta) {
                showToast("Pasta criada com sucesso!");
                fecharModalCriarPasta();
                renderSidebar();
            }
        }

        async function removerPasta(id = pastaContextMenuId) {
            if (!id) return;
            if (confirm("Tem certeza que deseja excluir esta pasta e todas as suas provas e quest√µes?")) {
                const result = await deleteData(`pastas/${id}`);
                if (result) {
                    showToast("Pasta exclu√≠da com sucesso!");
                    contextMenuPasta.style.display = "none";
                    goToHome();
                }
            }
        }

        function abrirModalCriarProva() {
            inputTituloProva.value = "";
            inputDescricaoProva.value = "";
            modalCriarProva.style.display = "block";
        }

        function fecharModalCriarProva() {
            modalCriarProva.style.display = "none";
        }

        async function criarProva() {
            const titulo = inputTituloProva.value.trim();
            const descricao = inputDescricaoProva.value.trim();

            if (!titulo) {
                showToast("O t√≠tulo da prova √© obrigat√≥rio!", "error");
                return;
            }

            const novaProva = await postData("provas", { titulo, descricao, pasta: currentPastaId });
            if (novaProva) {
                showToast("Prova criada com sucesso!");
                fecharModalCriarProva();
                goToPasta(currentPastaId);
            }
        }

        async function removerProva(id = provaContextMenuId) {
            if (!id) return;
            if (confirm("Tem certeza que deseja excluir esta prova e todas as suas quest√µes?")) {
                const result = await deleteData(`provas/${id}`);
                if (result) {
                    showToast("Prova exclu√≠da com sucesso!");
                    contextMenu.style.display = "none";
                    if (currentPastaId) {
                        goToPasta(currentPastaId);
                    } else {
                        goToHome();
                    }
                }
            }
        }

        function abrirModalInserirSQL() {
            sqlInput.value = "";
            resultadoInsercaoDiv.style.display = "none";
            resultadoListaDiv.innerHTML = "";
            modalInserirSQL.style.display = "block";
        }

        function fecharModalInserirSQL() {
            modalInserirSQL.style.display = "none";
        }

        async function inserirSQLDireto() {
            const jsonString = sqlInput.value.trim();
            if (!jsonString) {
                showToast("Por favor, cole o JSON das quest√µes.", "error");
                return;
            }

            try {
                const questoesData = JSON.parse(jsonString);
                const result = await postData("questoes/bulk", questoesData);
                if (result) {
                    resultadoInsercaoDiv.style.display = "block";
                    resultadoListaDiv.innerHTML = "";

                    result.sucessos.forEach(s => {
                        const div = document.createElement("div");
                        div.className = "resultado-item resultado-sucesso";
                        div.textContent = `Quest√£o ${s.index} (Ano: ${s.ano}, Pasta: ${s.pasta}, Prova: ${s.prova}) inserida com sucesso.`;
                        resultadoListaDiv.appendChild(div);
                    });

                    result.erros.forEach(e => {
                        const div = document.createElement("div");
                        div.className = "resultado-item resultado-erro";
                        div.textContent = `Erro na quest√£o ${e.questao}: ${e.erro}`; 
                        resultadoListaDiv.appendChild(div);
                    });

                    showToast(`Inser√ß√£o em lote conclu√≠da: ${result.sucessos.length} sucessos, ${result.erros.length} erros.`, "info");
                    renderSidebar();
                }
            } catch (error) {
                console.error("Erro ao parsear JSON:", error);
                showToast(`Erro ao parsear JSON: ${error.message}`, "error");
            }
        }

        let pastaParaMoverId = null;
        function moverPasta(id = pastaContextMenuId) {
            pastaParaMoverId = id;
            populateDestinoPastaSelect(id);
            modalMoverPasta.style.display = "block";
        }

        function fecharModalMoverPasta() {
            modalMoverPasta.style.display = "none";
            pastaParaMoverId = null;
        }

        async function populateDestinoPastaSelect(pastaAtualId) {
            selectDestinoPasta.innerHTML = 
                `<option value="">Nenhuma (Pasta Raiz)</option>`;
            const pastas = await fetchPastas();
            if (pastas) {
                pastas.forEach(pasta => {
                    // N√£o permitir mover para a pr√≥pria pasta ou para uma de suas subpastas
                    if (pasta._id !== pastaAtualId && !isDescendant(pastaAtualId, pasta._id, pastas)) {
                        const option = document.createElement("option");
                        option.value = pasta._id;
                        option.textContent = pasta.nome;
                        selectDestinoPasta.appendChild(option);
                    }
                });
            }
        }

        function isDescendant(ancestorId, descendantId, allPastas) {
            let current = allPastas.find(p => p._id === descendantId);
            while (current) {
                if (current.parent === ancestorId) {
                    return true;
                }
                current = allPastas.find(p => p._id === current.parent);
            }
            return false;
        }

        async function confirmarMoverPasta() {
            const novoParentId = selectDestinoPasta.value || null;
            if (!pastaParaMoverId) return;

            const result = await putData(`pastas/${pastaParaMoverId}/mover`, { novoParentId });
            if (result) {
                showToast("Pasta movida com sucesso!");
                fecharModalMoverPasta();
                renderSidebar();
                goToHome(); // Voltar para o in√≠cio ou para a nova pasta pai
            }
        }

        // Context Menu Logic
        function showContextMenu(event, menuElement) {
            menuElement.style.display = "block";
            menuElement.style.left = event.pageX + "px";
            menuElement.style.top = event.pageY + "px";
        }

        document.addEventListener("click", () => {
            contextMenu.style.display = "none";
            contextMenuPasta.style.display = "none";
        });

        // Inicializa√ß√£o
        document.addEventListener("DOMContentLoaded", () => {
            renderSidebar();
            goToQuestao(); // Iniciar na tela de adicionar quest√£o
        });

        // Fun√ß√£o para mostrar SQL de uma quest√£o espec√≠fica
        async function mostrarSQLQuestao(questaoId) {
            const questao = await fetchQuestao(questaoId);
            if (questao) {
                codigoGerado.textContent = JSON.stringify(questao, null, 2);
                abrirModalSQL();
            }
        }

        // Fun√ß√£o para mostrar SQL de todas as quest√µes de uma prova
        async function mostrarSQLProva() {
            if (!currentProvaId) return;
            const prova = await fetchProva(currentProvaId);
            if (prova && prova.questoes) {
                const questoes = prova.questoes;
                codigoGerado.textContent = JSON.stringify(questoes, null, 2);
                abrirModalSQL();
            }
        }

    </script>
</body>
</html>

